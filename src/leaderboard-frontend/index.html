<!doctype html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
  <title>Gamify AWS and HCP Leaderboard</title>
</head>

<body>

  <div class="container-fluid">
    <h1>Gamify AWS and HCP Leaderboard</h1>
    <div class="form-group">
      <input type="text" class="form-control" id="inputLeaderboard" placeholder="Enter function URL">
    </div>
    <div>
        <canvas id="myChart"></canvas>
    </div>
      
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>

      // Load the chart from the function URL
      window.addEventListener('load', function() {
        leaderboardUrl = localStorage.getItem('leaderboardUrl');
        document.getElementById('inputLeaderboard').value = leaderboardUrl;

        fetch(leaderboardUrl)
          .then(response => response.json())
          .then(response => {
            chart.data.datasets[0].data = response;
            chart.update();
          })
          .catch(err => {
            console.log(err.message || err);
          })
      });

      const ctx = document.getElementById('myChart');
    
      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: [],
          datasets: [{
            label: '# of Points',
            data: [],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            colors: {
              enabled: true
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });

      setInterval(function() {
        leaderboardUrl = document.getElementById('inputLeaderboard').value;

        localStorage.setItem('leaderboardUrl', leaderboardUrl);

        fetch(leaderboardUrl)
          .then(response => response.json())
          .then(response => {
            chart.data.datasets[0].data = response;
            chart.update();
          })
          .catch(err => {
            console.log(err.message || err);
          })
      }, 10000);
    </script>
</body>

</html>